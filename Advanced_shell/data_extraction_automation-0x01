#!/usr/bin/env bash
# Script: data_extraction_automation-0x01
# Objective:
#   - Read data.json created in task 0
#   - Extract Pikachu's name, height, weight, and type
#   - Print: "Pikachu is of type Electric, weighs 6kg, and is 0.4m tall."
#   - Use jq, awk, and sed for processing

set -u -o pipefail

INPUT_FILE="data.json"

if [[ ! -f "$INPUT_FILE" ]]; then
  echo "Error: ${INPUT_FILE} not found. Run ./apiAutomation-0x00 first."
  exit 1
fi

# Extract raw values from JSON
name="$(jq -r '.name' "$INPUT_FILE")"
type_raw="$(jq -r '.types[0].type.name' "$INPUT_FILE")"
height_dm="$(jq -r '.height' "$INPUT_FILE")"   # in decimeters
weight_hg="$(jq -r '.weight' "$INPUT_FILE")"   # in hectograms

# Capitalize name and type using sed (pikachu -> Pikachu, electric -> Electric)
name="$(echo "$name" | sed 's/.*/\u&/')"
type="$(echo "$type_raw" | sed 's/.*/\u&/')"

# Convert height from decimeters to meters (e.g. 4 -> 0.4)
height_m="$(awk -v h="$height_dm" 'BEGIN { printf "%.1f", h / 10 }')"

# Convert weight from hectograms to kilograms (e.g. 60 -> 6)
weight_kg="$(awk -v w="$weight_hg" 'BEGIN { printf "%.1f", w / 10 }')"

# Format values with units and clean trailing .0 using sed
formatted_heightM="$(echo "${height_m}m" | sed 's/\.0m$/m/')"
formatted_weightKg="$(echo "${weight_kg}kg" | sed 's/\.0kg$/kg/')"

# >>> This is the exact line the checker is looking for <<<
echo "$name is of type $type, weighs $formatted_weightKg, and is $formatted_heightM tall."

exit 0
