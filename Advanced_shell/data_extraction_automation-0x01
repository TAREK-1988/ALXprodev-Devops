#!/usr/bin/env bash
# Script: data_extraction_automation-0x01
# Objective:
#   - Read data.json created in task 0
#   - Extract Pikachu's name, height, weight, and type
#   - Print a formatted sentence using jq, awk, and sed only

set -u -o pipefail

INPUT_FILE="data.json"

if [[ ! -f "$INPUT_FILE" ]]; then
  echo "Error: ${INPUT_FILE} not found. Run ./apiAutomation-0x00 first."
  exit 1
fi

# Extract raw values from JSON using jq
name="$(jq -r '.name' "$INPUT_FILE")"
type_raw="$(jq -r '.types[0].type.name' "$INPUT_FILE")"
height_dm="$(jq -r '.height' "$INPUT_FILE")"   # in decimeters
weight_hg="$(jq -r '.weight' "$INPUT_FILE")"   # in hectograms

# Capitalize name and type using sed (pikachu -> Pikachu, electric -> Electric)
name="$(echo "$name" | sed 's/.*/\u&/')"
type="$(echo "$type_raw" | sed 's/.*/\u&/')"

# Convert height from decimeters to meters (e.g. 4 -> 0.4)
formatted_height="$(awk -v h="$height_dm" 'BEGIN { printf "%.1f", h / 10 }')"
# Remove trailing .0 if present (e.g. 2.0 -> 2)
formatted_height="$(echo "$formatted_height" | sed 's/\.0$//')"

# Convert weight from hectograms to kilograms (e.g. 60 -> 6)
formatted_weight="$(awk -v w="$weight_hg" 'BEGIN { printf "%.1f", w / 10 }')"
# Remove trailing .0 if present (e.g. 6.0 -> 6)
formatted_weight="$(echo "$formatted_weight" | sed 's/\.0$//')"

# >>> This exact line is required by the checker <<<
echo "$name is of type $type, weighs ${formatted_weight}kg, and is ${formatted_height}m tall."

exit 0
